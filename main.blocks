<xml xmlns="https://developers.google.com/blockly/xml"><block type="pxt-on-start" id="Rzb^t96P4{reig#o~Fa-" x="0" y="0"><statement name="HANDLER"><block type="typescript_statement" id="YVmVGGSC^Uf!Iu7duU_#" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="namespace weatherSensors {" line1="    let AHT20_I2C_ADDR = 0x38; // Dirección I2C del AHT20" line2="    let BMP280_I2C_ADDR = 0x76; // Dirección I2C del BMP280" line3="    let seaLevelhPa: number = 101325;" line4="    " line5="    function initAHT20() {" line6="        // Agregar lógica de inicialización para AHT20" line7="        " line8="            let initCmd = pins.createBuffer(3);" line9="            initCmd[0] = 0xE1; // Comando de inicialización" line10="            initCmd[1] = 0x08;" line11="            initCmd[2] = 0x00;" line12="            pins.i2cWriteBuffer(AHT20_I2C_ADDR, initCmd, false);" line13="            basic.pause(10); // Espera para que el sensor se estabilice" line14="        " line15="" line16="    " line17="    }" line18="" line19="    function initBMP280() {" line20="        // Configuración para el control de medición, configuración y selección de modo" line21="        let ctrlMeas = pins.createBuffer(2);" line22="        ctrlMeas[0] = 0xF4; // Dirección del registro de control de medición" line23="        ctrlMeas[1] = 0x27; // 00100111: modo normal, oversampling x1 para presión y temperatura" line24="        pins.i2cWriteBuffer(BMP280_I2C_ADDR, ctrlMeas, false);" line25="" line26="        let config = pins.createBuffer(2);" line27="        config[0] = 0xF5; // Dirección del registro de configuración" line28="        config[1] = 0xA0; // 10100000: filtro off, standby time 1000 ms" line29="        pins.i2cWriteBuffer(BMP280_I2C_ADDR, config, false);" line30="" line31="        basic.pause(100); // Espera para que el sensor se estabilice" line32="    }" line33="" line34="" line35="    //% blockId=&quot;read_aht20_temperature&quot; block=&quot;read temperature from AHT20&quot;" line36="    //% weight=100 group=&quot;AHT20&quot;" line37="    export function readTemperature(): number {" line38="        initAHT20();" line39="        let buffer = pins.i2cReadBuffer(AHT20_I2C_ADDR, 6, false);" line40="        let temperature = -40 + ((buffer[3] &amp; 0xFF) &lt;&lt; 8 | (buffer[4] &amp; 0xFF)) * 0.02;" line41="        return temperature;" line42="    }" line43="" line44="    //% blockId=&quot;read_aht20_humidity&quot; block=&quot;read humidity from AHT20&quot;" line45="    //% weight=95 group=&quot;AHT20&quot;" line46="    export function readHumidity(): number {" line47="        initAHT20();" line48="        let buffer2 = pins.i2cReadBuffer(AHT20_I2C_ADDR, 6, false);" line49="        let humidity = ((buffer2[1] &amp; 0xFF) &lt;&lt; 8 | (buffer2[2] &amp; 0xFF)) * 0.0244;" line50="        return humidity;" line51="    }" line52="" line53="    //% blockId=&quot;read_bmp280_pressure&quot; block=&quot;read pressure from BMP280&quot;" line54="    //% weight=90 group=&quot;BMP280&quot;" line55="    export function readPressure(): number {" line56="        initBMP280();" line57="        let buffer3 = pins.i2cReadBuffer(BMP280_I2C_ADDR, 3, false);" line58="        let pressure = ((buffer3[0] &amp; 0xFF) &lt;&lt; 12 | (buffer3[1] &amp; 0xFF) &lt;&lt; 4 | (buffer3[2] &amp; 0xFF) &gt;&gt; 4);" line59="        return pressure;" line60="    }" line61="" line62="    //% blockId=&quot;calculate_altitude&quot; block=&quot;calculate altitude from BMP280 pressure&quot;" line63="    //% weight=80 group=&quot;BMP280&quot;" line64="    export function calculateAltitude(): number {" line65="        let pressure2 = readPressure();" line66="        let altitude = 44330 * (1 - Math.pow(pressure2 / seaLevelhPa, 0.1903));" line67="        return altitude;" line68="    }" line69="}" numlines="70"></mutation></block></statement></block></xml>